https://myht.ru/question/2036654-zapustite-php-skript-kak-process-demona


Рабочая инструкция:

1. Делаем файл myphpdaemon.service и помещаем его в /etc/systemd/system/ (или символьной ссылкой)
Путь до myphpdaemon.php свой
Содержание:

[Unit]
Description=My PHP Daemon Service
#May your script needs MySQL or other services to run, eg. MySQL Memcached
#Requires=mysqld.service memcached.service 
#After=mysqld.service memcached.service

[Service]
User=root
Type=simple
TimeoutSec=0
PIDFile=/var/run/myphpdaemon.pid
ExecStart=/usr/bin/php -f /home/astrviktor/myphpdaemon.php arg1 arg2> /dev/null 2>/dev/null
#ExecStop=/bin/kill -HUP $MAINPID #It's the default you can change whats happens on stop command
#ExecReload=/bin/kill -HUP $MAINPID
KillMode=process

Restart=on-failure
RestartSec=60s

[Install]
WantedBy=default.target



2. Делаем файл myphpdaemon.php

<?php
while (!connection_aborted() || PHP_SAPI == "cli") {

  //Code Logic
  for ($i = 1; $i <= 10000000; $i++)
  {
    $j = $j + $i;
  }

  //sleep 
  sleep(10);
}


Управление демоном

    sudo systemctl <start|status|restart|stop|enable> myphpdaemon

