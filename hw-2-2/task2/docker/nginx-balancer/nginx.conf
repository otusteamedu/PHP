user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    upstream backend  {
      server 192.168.9.3 weight=4;

      server server2-unix-socket weight=1;

      server server3-unix-socket weight=1;

      server server4-web-socket weight=1;

      server 34.125.62.174 weight=1;
    }

    server {
      listen 80;
      listen [::]:80;
      server_name hw-2-2.task2.balancer.docker;
      location / {
        rewrite ^(.*)$ https://hw-2-2.task2.balancer.docker$1 permanent;
      }
    }


    server {
      listen 443 ssl;
      listen [::]:443 ssl;

      ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
      ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;

      server_name hw-2-2.task2.balancer.docker;

      location / {
        proxy_pass  http://backend;
      }
    }
}

