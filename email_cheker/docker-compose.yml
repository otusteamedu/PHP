version: '3'
services:
    web:
        image: sokolov/nginx:latest
        ports: 
            - 80:80
        # command: chmod 0777 /sock/docker.sock
        volumes:
            - ./sock:/sock
            - ./App:/usr/src/mysite.local/App
            - ./index.php:/usr/src/mysite.local/index.php
            - ./nginx/mysite.local.conf:/etc/nginx/conf.d/mysite.local.conf
            - ./nginx/nginx.conf:/etc/nginx/nginx.conf
        
        links:
            - php
        networks:
            - test_network
    php:
        image: sokolov/php-fpm-user:latest
        # command: chmod 0777 /sock/docker.sock
        volumes:
            - ./App:/usr/src/mysite.local/App
            - ./index.php:/usr/src/mysite.local/index.php
            - ./vendor:/usr/src/mysite.local/vendor
            - ./composer.json:/usr/src/mysite.local/composer.json
            - ./sock:/sock
            - ./fpm/app.conf:/usr/local/etc/php-fpm.d/app.conf
        
        networks:
            - test_network
networks:
    test_network:
        external: true
    
        