# Тестовые кейсы

## Модульные тесты

#### Валидация формы оплаты заказа банковской картой
_test/unit/App/Form/PayCardFormTest.php_

1. Если форма заполнена валидными данными, то:
    * метод `isValidate()` должен вернуть **true**
    * форма не должна содержать ошибок валидации

2. Если в форму пришли не все данные, например, из 6 полей пришло 4, но эти поля заполнены верно, то валидация должна вернуть **false**.

3. Проверить правила валидации поля **card_number**:
    * данные содержат не числовой символ
    * номер длинней 16 символов
    * номер короче 16 символов
    * ничего не передано
    
4. Проверить правила валидации поля **card_holder**:
    * переданы только фамилия или имя
    * есть больше одного пробела
    * содержит запрещенные символы
    * ничего не передано
    
5. Проверить правила валидации поля **card_expiration**:
    * если содержит только месяц
    * если содерижт только год
    * передан не существующий месяц
    * используется не корректный разделитель месяца и года
    * год передан не в верном формате
    * переданы не числа
    * ничего не передано

6. Проверка правил валидации поля **cvv**:
    * больше 3 цифр
    * меньше 3 цифр
    * не цифра
    * ничего не передано
    
7. Проверка правил валидации поля **order_number**:
    * больше 16 символов
    * меньше 16 символов
    * ничего не передано
    
8. Проверка правил валидации поля **sum**:
    * неверный разделитель целой и дробной части
    * переданы не цифры
    * передано отрицательное число
    * дробная часть не больше 2 знаков
    * числа: 125,56; 125,5; 125; 0,45 - проходят валидацию 
    * ничего не передано
    
#### Фреймворк

Резолвер обработчиков  
_test/unit/Framework/Pipeline/HandlerResolverTest.php_

1. Получение обработчика, если на входе контроллер с экшеном
2. Получение обработчика, если на входе контроллер с __invoke методом
3. Получение обработчика, если на входе на входе middleware в виде строки
4. Проверка исключения в случае, если обработчик не найден 

Роутер  
_test/unit/Framework/Router/AuraRouterAdapterTest.php_

1. Метод `match()` должен вернуть `Result` класс.
2. Если роут найден, то класс `Result` должен содержать имя роута
3. Если роут найден, то класс `Result` должен содержать обработчик роута
4. Если роут найден, то класс `Result` должен содержать атрибуты роута
5. Если роут не найден, то должно сработать исключение `RouteNotMatchedException`

## Системные тесты
#### Контроллер оплаты заказа
_test/integration/App/Controller/BillingControllerTest.php_

1. Запрос содержит валидные данные
    * Ответ должен быть 200
    * В ответе должно быть поле **is_succeed = true**
    
2. Заказ не найден
    * Ответ должен быть 400
    * В ответе должно быть поле **is_succeed = false**
    * Ответ должен содержать описание ошибки - Order #XXX not found
    
3. Сумма заказа не совпала с суммой в базе
    * Ответ должен быть 400
    * В ответе должно быть поле **is_succeed = false**
    * Ответ должен содержать описание ошибки - Order #XXX - sum is not match
    
4. В базе у заказа изменился статус оплаты на **true**

## Интеграционные тесты
#### Репозиторий для работы с заказами
_test/integration/App/Repository/OrderRepositoryTest.php_

1. Поиск по номеру заказа, результат должен вернуть сущность класса OrderEntity
2. Если заказ не найден, то должно сработать исключение
3. Проверка, что метод `setOrderIsPaid` меняет статус заказа
4. Проверка, что в методе `setOrderIsPaid` сработает исключение, если заказ уже оплачен
4. Проверка, что в методе `setOrderIsPaid` сработает исключение, если сумма заказа не совпадает
