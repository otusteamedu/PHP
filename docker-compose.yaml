version: "3"

services:
  server:
    build:
      context: ./docker
    image: my-php
    working_dir: ${WORKDIR}
    environment:
      - SOCKET_DIR=${SOCKET_DIR}
      - SOCKET_FILE=${SOCKET_FILE}
    volumes:
    - ./code:${WORKDIR}
    - sock:${SOCKET_DIR}
    command: ["php", "console/app.php", "server"]

  client:
    image: my-php
    working_dir: ${WORKDIR}
    environment:
      - SOCKET_DIR=${SOCKET_DIR}
      - SOCKET_FILE=${SOCKET_FILE}
    depends_on:
      - server
    volumes:
      - ./code:${WORKDIR}
      - sock:${SOCKET_DIR}

volumes:
  sock:
