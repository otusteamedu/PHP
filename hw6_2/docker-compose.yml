version: "3.3"
services:
    nginx-main:
            build:
                 context: ./docker/
                 dockerfile: Nginx-main.Dockerfile
            ports:
                - 8081:80
            links:
                - nginx-1
                - nginx-2
                - nginx-3 
    nginx-1:
        build:
            context: ./docker/
            dockerfile: Nginx.Dockerfile
        links:
            - php-fpm-1
        volumes:
            - ./site/:/var/www/html
            - "phpsocket:/var/run"               
    nginx-2:
        build:
            context: ./docker/
            dockerfile: Nginx.Dockerfile 
        links:
            - php-fpm-1
        volumes:
            - ./site/:/var/www/html
            - "phpsocket:/var/run"
    nginx-3:
        build:
            context: ./docker/
            dockerfile: Nginx.Dockerfile
        links:
            - php-fpm-1
        volumes:
            - ./site/:/var/www/html
            - "phpsocket:/var/run"
    php-fpm-1:
        build:
            context: ./docker/
            dockerfile: Fpm.Dockerfile
        volumes:
            - ./site/:/var/www/html
            - ./config-php-fpm/php-fpm.conf:/usr/local/etc/php-fpm.conf
            - ./www/www.conf:/usr/local/etc/php-fpm.d/www.conf
            - ./zz-docker/zz-docker.conf:/usr/local/etc/php-fpm.d/zz-docker.conf
            - "phpsocket:/var/run"

volumes:
    phpsocket:

 
