# Простые запросы

## билеты дороже 100 руб

Исходный запрос:
````postgresql
select * from ticket where coast >= 100;
````

План выполнения
````sql
QUERY PLAN                                                |
----------------------------------------------------------|
Seq Scan on ticket  (cost=0.00..189.00 rows=6619 width=21)|
  Filter: (coast >= '100'::numeric)                       |
````

Для получения результата, было выполнено последовательное чтение всей таблицы.
Что-бы уменьшить время выполнения, необходимо создать индекс для поля `coast`. 
Если запрос с параметром `coat >= 100` используется часто, то лучше создать частичный индекс, в котором `coast` будет больше либо равен 100.

````postgresql
create index ticket_coast_100 on ticket (coast) where coast >= 100;
```` 

Но, как видим из плана выполнения, это не помогло:
````sql
QUERY PLAN                                                |
----------------------------------------------------------|
Seq Scan on ticket  (cost=0.00..189.00 rows=6619 width=21)|
  Filter: (coast >= '100'::numeric)                       |
````
Зато, если выполнить запрос с равенством (`coast=101`), то увидим, что используется созданный индекс:
````sql
QUERY PLAN                                                                    |
------------------------------------------------------------------------------|
Index Scan using ticket_coast_100 on ticket  (cost=0.28..8.29 rows=1 width=21)|
  Index Cond: (coast = '101'::numeric)                                        |
````
Создание полного индекса для поля `coast` так же не приводит к его использованию.
Это связано с тем, что получаемые значения ни как не отсортированы.
Но если изменить запрос и добавить в него `ORDER BY`, то мы видим, что используется частичный индекс:
````sql
select * from ticket where coast >= 100 order by coast;

QUERY PLAN                                                                         |
-----------------------------------------------------------------------------------|
Index Scan using ticket_coast_100 on ticket  (cost=0.28..439.28 rows=6619 width=21)|
````