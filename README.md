### К уроку 7

Спроектируйте схему данных для системы управления кинотеатром: 
* Кинотеатр имеет несколько залов, в каждом зале идет несколько разных сеансов, клиенты могут купить билеты на сеансы
* Спроектировать базу данных для управления кинотеатром
* Задокументировать с помощью логической модели
* Написать DDL скрипты
* Написать SQL для нахождения самого прибыльного фильма

```
cinema_postgres_create.sql - DDL скрипт для создания структуры БД
sql_most_popular_film - sql запрос для поиска самого прибыльного фильма в БД
cinema_db.png - логическая схема БД

результат выполнения скрипта поиска самого прибыльного фильма:
```
![Image alt](https://github.com/otusteamedu/PHP/blob/iglushkov/hm3-1/sql_res.png)

### К уроку 9

Спроектировать EAV-хранение для базы данных кинотеатра
4 таблицы: фильмы, атрибуты, типы атрибутов, значения.
Типы атрибутов и соответствующие им атрибуты (для примера):
- рецензии (текстовые значения) - рецензии критиков, отзыв неизвестной киноакадемии ...
- премия (заменяется при печати баннеров и билетов на изображение, логическое значение) - оскар, ника ...
- "важные даты" даты (при печати - наименование атрибута и значение даты, тип дата) - мировая премьера, премьера в РФ ... 
- служебные даты (используются при планировании, тип дата) - дата начала продажи билетов, когда запускать рекламу на ТВ ...
View сборки служебных данных в форме (три колонки):
- фильм, задачи актуальные на сегодня, задачи актуальные через 20 дней 
View сборки данных для маркетинга в форме (три колонки):
- фильм, тип атрибута, атрибут, значение (значение выводим как текст) 

```
ddl_eav.sql - DLL скрипт для создания структуры EAV-хранения

схема EAV-хранение:
```
![Image alt](https://github.com/otusteamedu/PHP/blob/iglushkov/hm3-1/EAV.png)

```
View служебная дата - сам запрос в файлике view
```sql
select * from serviceData
```
![Image alt](https://github.com/otusteamedu/PHP/blob/iglushkov/hm3-1/service.png)

```
View маркетинга - сам запрос в файлике view
```sql
select * from marketData
```
![Image alt](https://github.com/otusteamedu/PHP/blob/iglushkov/hm3-1/market.png)

### К уроку 10

Подготовить список из 6 основных запросов к БД, разработанной на предыдущих занятиях. Целесообразно выбрать 3 "простых" (задействована 1 таблица), 3 "сложных" (агрегатные функции, связи таблиц). 
Скрипт для наполнения основных таблиц БД тестовыми данными.
Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000.
Провести анализ производительности запросов к БД, сохранить планы выполнения.
Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000000.
Провести анализ производительности запросов к БД, сохранить планы выполнения.
На основе анализа запросов и планов предложить оптимизации (индексы, структура, параметры и др.), выполнить их, сравнить результат (планы выполнения).

```
сложные 3 запроса лежат в файле - complicated_sql_request.sql
простые 3 запроса лежат в файле - simple_sql_request.sql

попробовал провести оптимизацию запроса на 10000000 строк: 
результаты оптимизации ниже (построил индексы по полям)
```
```sql
select films.name as film_name, film_attr."name" as attr_name, concat(t1.val_date, t1.val_money, t1.val_text) as value
from value_film_attr as t1
inner join films on films.film_id = t1.film_id
inner join film_attr on film_attr.attr_id = t1.attr_id
inner join type_attr on type_attr.type_id = film_attr.type_id
```
![Image alt](https://github.com/otusteamedu/PHP/blob/iglushkov/hm3-1/no_index.png)
![Image alt](https://github.com/otusteamedu/PHP/blob/iglushkov/hm3-1/index.png)
