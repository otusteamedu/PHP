## Структура проекта
>app/start.php -
Точка входа

>`app/Providers/AppServiceProvider.php` -
Определяет подключение к выбранной в конфигурации базе данных

>`Services\Connectors` -
Содержит классы установки соединения с выбранной базой данных

>`Services\Connectors\Dao` -
Содержит паттерны работы с базой данных
> - DataMapper
> - TableGateway
> - IdentityMap
> 
> Services/Dao/DaoService.php -
Осуществляет доступ к данным паттернам

> Dto -
Хранит набор объектов с атрибутами, соответствующими полям из таблиц

> src - 
находятся Контроллеры и Модели для таблиц из базы данных

## Настройки Базы данных

Реализованы 2 вида хранилищ.
- **mysql**
- **postgres**

Для выбора хранилища необходимо в `.env` установить параметр
- `DB_CONNECTION=mysql` для Mysql
- `DB_CONNECTION=postgres` для Postgres

по умолчанию используется Postgres.

## Заполнение данными
Необходимо в используемой DB создать базу данных например `otus_cinema`. 
В папке db находятся скрипты для добавления таблиц. Для Postgres так же есть скрипты для добавления
тестовых данных `/db/scripts/addTestData.sql`.
Необходимо некоторое время (около 5-6минут) чтобы заполнилась таблица с билетами на год, 
по расписанию для нескольких кинозалов.

## Использование паттерна IdentityMap
Для отключения паттерна необходимо в `.env` установить параметр
- `USE_IDENTITY_MAP=False`

включен по умолчанию.

##Маршруты:
- `otus.loc/movie?id=1`: вызывает метод ->run() в конструкторе Movie - показывает объект из таблицы movie с выбранным id 
- `otus.loc/movie/insert`: вызывает метод ->insert() в конструкторе Movie - добавляет новый фильм из файла в корне проекта data.txt
- `otus.loc/movie/update?id=2`: вызывает метод ->update() в конструкторе Movie - обновляет фильм, добавляя -updated к имени фильма.
Если используется паттерн `IdentityMap`, то так же будут увеличены на 1 разрешенный возраст и значение id жанра, связанное с таблицей `movie_genre`
- `otus.loc/movie/delete?id=2`: вызывает метод ->delete() в конструкторе Movie - удаляет фильм.

Такие же маршруты предусмотрены для таблицы `room`
- `otus.loc/room?id=1`: вызывает метод ->run() в конструкторе Room 
- `otus.loc/room/insert`: вызывает метод ->insert() в конструкторе Room 
- `otus.loc/room/update?id=2`: вызывает метод ->update() в конструкторе Room
- `otus.loc/room/delete?id=2`: вызывает метод ->delete() в конструкторе Room


