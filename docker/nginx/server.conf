server {
    server_name otus-2019-05.darkdragon.lan;

    listen 80 default_server;

    access_log "/proc/self/fd/1" combined;
    error_log "/proc/self/fd/2" warn;

    charset UTF-8;

    add_header "X-UA-Compatible" "IE=edge" always;

    root "/var/www/html";
    try_files $uri =404;

    index index.html index.htm;

    # Will generate index pages for directories
    autoindex on;

    location = /index.html {
        internal;
    }
    location = /index.htm {
        internal;
    }

    location / {
        try_files $uri $uri/ @php;
    }

    # Will pass to FastCGI server
    location @php {

        # Default CGI variables
        include "fastcgi_params";

        # Path to the script at the CGI server side
        fastcgi_param SCRIPT_FILENAME "/var/www/web.php";

        # Mitigate https://httpoxy.org/ vulnerabilities
        fastcgi_param HTTP_PROXY "";

        # Override SERVER_NAME from `~/fastcgi_params' with a saner default
        fastcgi_param SERVER_NAME "$host";

        # Variables to tell the application, where to send technical mails and what to include in error pages
        fastcgi_param SERVER_ADMIN "webmaster@$host";
        fastcgi_param SERVER_SIGNATURE "<address>nginx/$nginx_version server at $host port $server_port</address>";

        # File that will be appended to $fastcgi_script_name for directories
        # Used in only one case - when a location blindly proxied to CGI server
        #fastcgi_index  index.php;

        # Slightly increse backend interaction performance by keeping a socket open
        fastcgi_keep_conn on;

        fastcgi_pass php-fpm:9000;
    }

    #error_page 404 /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }

    # deny access to .ht* files
    location ~ /\.ht {
        deny all;
    }
}
