# Модульные тесты  
##### Отрицательное ожидание

- передаём в метод поле `order_number` со значением **``** – ожидаем ответ с 
    кодом 403 и наличие элемента массива `error` со значением `order_number`
    _(пустое значение)_
- передаём в метод поле `order_number` со значением **`12-45678901Ui4567`** – 
ожидаем ответ с кодом 403 и наличие элемента массива `error` со значением `order_number`
    _(проеврка на длину более 16 символов)_

- передаём в метод поле `card_number` со значением **``** – ожидаем ответ с 
    кодом 400 и наличие элемента массива `error` со значением `card_holder`
    _(пустое значение)_
- передаём в метод поле `card_number` со значением **`123456789012345`** – ожидаем ответ с 
    кодом 400 и наличие элемента массива `error` со значением `card_holder`
    _(проеврка на длину менее 16)_
- передаём в метод поле `card_number` со значением **`12345678901234567`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_holder`
      _(проеврка на длину более 16)_
- передаём в метод поле `card_number` со значением **`12345678901234567`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_holder` 
      _(проеврка на нечисловой смтвол в номере карты)_
            
- передаём в метод поле `card_holder` со значением **``** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_holder` 
      _(пустое значение)_           
- передаём в метод поле `card_holder` со значением **`A. BELTYUKOV`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_holder` 
      _(содержит символы, кроме A-Z, пробела и дефиса)_   
- передаём в метод поле `card_holder` значение **`ANDREY BELT -YUKOV`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_holder` 
      _(содержит дефис после пробела)_   
- передаём в метод поле `card_holder` значение **`-ANDREY BELTYUKOV`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_holder` 
      _(начинается с дефиса)_   
- передаём в метод поле `card_holder` со значением **`ANDREY BELTYUKOV V`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_holder`  
      _(кол-во пробелов более одного)_   
      
- передаём в метод поле `card_expiration` со значением **``** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_expiration` 
      _(пустое значение)_
- передаём в метод поле `card_expiration` со значением **`13/99`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_expiration` 
      _(strtotime('01.'.'13.99') возвращaет false)_
- передаём в метод поле `card_expiration` со значением **`01/20`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_expiration` 
      _(вычисляемое значение strtotime('01.'.'01.20') < strtotime('01.' . date('m.y')))_
- передаём в метод поле `card_expiration` со значением **`11/28`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `card_expiration` 
      _(strtotime('01.'.'11.28') - strtotime('+4 Years') > 0_

- передаём в метод поле `cvv` со значением **``** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `cvv`
      _(пустое значение)_
- передаём в метод поле `cvv` со значением **`0001`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `cvv`
      _(содержит кол-во символов не равное 3)_
- передаём в метод поле `cvv` со значением **`01`** – ожидаем ответ с 
     кодом 400 и наличие элемента массива `error` со значением `cvv`
      _(содержит кол-во символов не равное 3)_      
- передаём в метод поле `cvv` со значением **`12t`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `cvv`
      _(содержит хотя бы один нечисловой символ)_
      
- передаём в метод поле `sum` со значением **``** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `sum`
      _(пустое значение)_
- передаём в метод поле `sum` со значением **`0,00`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `sum`
      _(вычисляемое значение является нолём)_
- передаём в метод поле `sum` со значением **`0.00`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `sum`
      _(значение передано в некорректном формате)_  
- передаём в метод поле `sum` со значением **`0,20,0`** – ожидаем ответ с 
      кодом 400 и наличие элемента массива `error` со значением `sum` 
      _(значение передано в некорректном формате)_  
  

- передаём в метод JSON 
    ```json
        {}
    ``` 
    ожидаем ответ с кодом 400 и JSON 
    ```json
        {"errors": ["card_number", "card_holder", "card_expiration", "cvv", "sum"]}
    ```    
    

##### Положительное ожидание
- передаём в метод JSON 
    ```json
        {
            "order_number": "testOrder1234567",
            "card_number": "0123456789123456",
            "card_holder": "ANDREY BELTYUKOV",
            "card_expiration": "02/24",
            "cvv": "000",  
            "sum": "200,00"
        }
    ```
    ожидаем ответ с кодом 200 и JSON 
    ```json
      {
          "result": true,
          "errors": []   
      }   
    ```
 
 - передаём в метод JSON 
     ```json
         {
             "order_number": "1",
             "card_number": "0000000000000000",
             "card_holder": "ANDR-EY BELTYU-KOV",
             "card_expiration": "02/20",
             "cvv": "000",  
             "sum": "0,01"
         }
     ```
     ожидаем ответ с кодом 20 и JSON 
     ```json
       {
           "result": true,
           "errors": []      
       }   
     ```

# Интеграционные тесты

### Фронт – бэк
- отправляем с бэка ответ с кодом `400` и JSON
```json
{
"errors": ["card_number", "card_holder", "card_expiration", "cvv"]
}
``` 
– на странице выделяются красной рамкой поля `card_number`, `card_holder`, 
`card_expiration` и `cvv`  
   
- отправляем с бэка ответ с кодом `400` и JSON
```json
{"errors": ["cvv"]}
```
– на странице выделяются красной рамкой поле `cvv`

- отправляем с бэка ответ с кодом `403` – на странице должна появиться 
надпись "Невозможно произвести оплату картой, проверьте введённые данные"

- отправляем с бэка ответ с кодом `500` – на странице должна появиться
надпись "Оплата временно не доступна. Попробуйе произвести оплату позднее"

- отправляем с бэка ответ с кодом `200` – на странице должна появиться надпись
"Оплата прошла успешно, перейти >> к просмотру фильма"

### Бэк – сервис А
- с бэка уходит HTTP запрос к API сервиса "A" с нулевой суммой списания 
ожидаеися ответ контроллера код `403` с текстом `Невозможно произвести оплату 
картой, проверьте введённые данные`.
_(ответ с кодом 200 как я понимаю мы не проверяем)_

### Бэк – репозиторий
- JSON {"order_number": "", sum: "0,01" ... валидные поля}, после вызова метода 
репозитория getOrderIsPaid('', .01) ожидаеися ответ контроллера код `403` с 
текстом `Невозможно произвести оплату картой, проверьте введённые данные`.
- JSON {"order_number": "test0001", sum: "0,01" ... валидные поля}, после вызова метода 
репозитория getOrderIsPaid('test0001', .01) ожидаеися ответ контроллера код `200` и JSON 
```json
    {
         "result": true,
         "errors": []      
    }   
```

# Системные тесты
Пытаемся оплатить фильм со страницы оплаты заблокированной картой (или тестовой
картой):
```
order_number: t100
card_number: 1234567890132456
card_holder: NEKTO HOLDER
card_expiration: 12/20
cvv: 123 
sum: 120,00
```
на странице ожидаем надпись `Невозможно произвести оплату картой, проверьте 
введённые данные`

## Примечания:
- Для удешевления проводимых тестов, полагаю есть одно решение: использовать 
тестовые данные, которые обычно предоставляются со стороны сервиса "А", либо
использовать тестовое окружение, предоставляемое обычно тем же сервисом "А" 
(как пример другой URL API или login, при использовании которых реальные 
средства не списываются).
- Есть один скользкий момент: если оплата прошла, а потом оказалось,
что номер заказа и сумма по каким-то причинам не совпали, бэк всё таки должен
вернуть ошибку `Заказ не может быть завершён, проверьте данные` или 200 OK.   
На мой взгляд, сначала нужно проверить возможность осуществления оплаты, записать
в бд с флажком `в обработке`, а потом если не удалось снять деньги – поменять 
статус на `ERROR` и отдать во фронт ошибку 403; если удалось ответить 200 OK    