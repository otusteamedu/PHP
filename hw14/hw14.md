# Домашнее задание № 14

## 1. Модульные тесты

### Поле card\_number

- Если card\_number содержит не только цифры, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если card\_number содержит меньше 16 символов, то тестируемый метод возвращает код 400 с сообщением об ошибке
- Если card\_number содержит больше 16 символов, то тестируемый метод возвращает код 400 с сообщением об ошибке

### Поле card\_holder

- Если card\_holder содержит более одного пробела, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если card\_holder содержит символы `~[^A-Za-z\ \-]~`, т.е. не допустимые символы, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если в card\_holder имеется дефис и он не разделяет два слова, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если в card\_holder содержится значение >21 символа, то тестируемый метод возвращает 400 с сообщением об ошибке (по правилам платежных систем (visa, mastercard и т.д.) максимальное количество символов составляет 21 знак с пробелом);

### Поле card\_expiration

- Если card\_expiration не содержит `~[01]\d\/\d{2}~`, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если год в card\_expiration содержит число меньшее текущего года , то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если поле card\_expiration содержит значение года равное текущему и значение месяца меньше текущего, то тестируемый метод возвращает код 400 с сообщением об ошибке

### Поле cvv

- Если cvv не содержит `~\d{3}~`, то тестируемый метод возвращает 400 с сообщением об ошибке;

### Поле order\_number

- Если order\_number содержит меньше 1 символа, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если order\_number содержит больше 16 символов, то тестируемый метод возвращает 400 с сообщением об ошибке;
  
### Поле sum

- Если sum не содержит `~\d+,\d+~` то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если sum содержит знак дробной части [,] но дробная часть не указана, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если sum содержит в целой части 0 и нет знака дробной части [,] то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если sum содержит в целой части 0 и есть знак дробной части [,] но дробная часть не указана, то тестируемый метод возвращает 400 с сообщением об ошибке;
- Если sum содержит в целой части 0 и есть знак дробной части [,] но в дробной части указаны только 0, то тестируемый метод возвращает 400 с сообщением об ошибке;

#### Positive

- Если все поля заполнены корректно, то тестируемый метод возвращает код 200 без сообщения об ошибке

### Метод репозитория

#### Проверка метода 

```php
setOrderIsPaid(string $orderNumber, float $sum): bool
```

- Если методу setOrderIsPaid передан пустой аргумент $orderNumber, выбросить исключение OrderIsPaidArgumentException;
- Если методу setOrderIsPaid передан пустой аргумент $sum, выбросить исключение OrderIsPaidArgumentException;
- Если методу setOrderIsPaid в аргумент $orderNumber передана не строка, выбросить исключение OrderProcessArgumentException;
- Если методу setOrderIsPaid в аргумент $orderNumber передано не вещественное число, выбросить исключение OrderIsPaidArgumentException;
- Если метод setOrderIsPaid вернул не boolean значение, выбросить исключение OrderIsPaidReturnException;
- Если метод setOrderIsPaid вернул false, выбросить исключение OrderIsPaidReturnException;

#### Positive setOrderIsPaid

- Если метод setOrderIsPaid выполнен без ошибок, то возвращается код 200 без сообщения об ошибке;

## 2. Интеграционные тесты

### Связка «фронт-бэк»

- При отправке не валидных данных поля card\_number, после получения ответа от сервера, поле card\_number
 подсвечивается красным цветом и над полем появляется сообщение об ошибке;
- При отправке не валидных данных поля card\_holder, после получения ответа от сервера, поле card\_holder
 подсвечивается красным цветом и над полем появляется сообщение об ошибке;
- При отправке не валидных данных поля card\_expiration, после получения ответа от сервера, поле card\_expiration
 подсвечивается красным цветом и над полем появляется сообщение об ошибке;
- При отправке не валидных данных поля cvv, после получения ответа от сервера, поле cvv
 подсвечивается красным цветом и над полем появляется сообщение об ошибке;
- При отправке не валидных данных поля order\_number, после получения ответа от сервера, поле order\_number
 подсвечивается красным цветом и над полем появляется сообщение об ошибке;
- При отправке не валидных данных поля sum, после получения ответа от сервера, поле sum
 подсвечивается красным цветом и над полем появляется сообщение об ошибке;

#### Positive

- При нажатии кнопки Отправить данные отправляются на бэк модуль и бэк модуль отправляет ответ, при получении фронт выводит сообщение об успешной оплате;

### Связка «бэк-сервис А»:

- Бэк отправляет API-запрос на сервис "А", сервис "А" не смог списать деньги и отправляет ответ с кодом 403;

#### Positive 

- Бэк отправляет API-запрос на сервис "А", сервис "А" списал деньги и отправляет ответ с кодом 200;

### Связка «бэк-репозиторий»:

- Бэк запускает метод репозитория setOrderIsPaid с невалидным значением аргумента $orderNumber, выбросывается исключение OrderIsPaidArgumentException;
- Бэк запускает метод репозитория setOrderIsPaid с невалидным значением аргумента $sum, выбросывается исключение OrderIsPaidArgumentException;

#### Positive 

- Бэк запускает метод репозитория setOrderIsPaid с валидными значениеми аргументов, репозиторий возвращает true;

## 3. Системные тесты:

- Фронт отправляет не валидное поле card\_number на бэк, бэк возвращает ответ с кодом 400, фронт подсвечивает поле card\_number красным цветом и выводит над ним сообщение с ошибкой "Поле card\_number заполнено не верно";
- Фронт отправляет валидный запрос на бэк, бэк отправляет запрос на сервис "A", сервис "А" не принимает данные карты и не пропускает платеж, и отправляет ошибку 403 на бэк, бэк отправляет на фронт ответ с кодом 403 и сообщением об ошибке при авторизации карты, фронт выводит сообщение об ошибке в красной рамке 
- Фронт отправляет валидный запрос на бэк, бэк отправляет запрос на сервис "А", при успешном выполнении сервис "А" отправляет ответ с кодом 200 на бэк, бэк для сохранения данных об оплате вызывает метод setOrderIsPaid репозитория, репозиторий не смог сохранить данные об оплате, выбрасывает исключение OrderProcessException, бэк отправляет на фронт,сообщение с кодом 500, фронт отображает сообщение в красной рамке "Во время оплаты возникла ошибка, мы свяжемся с Вами в ближайшее время";

#### Positive 

- Фронт отправляет валидный запрос на бэк, бэк отправляет запрос на сервис "А", при успешном выполнении сервис "А"отправляет ответ с кодом 200 на бэк, бэк для сохранения данных об оплате вызывает метод setOrderIsPaid репозитория, репозиторий успешно сохраняет данные об оплате и возвращает 200 на бэк, бэк отправляет на фронт, сообщение с кодом 200, фронт отображает сообщение в зеленой рамке "Оплата выполнена успешно. Заказ направляется в обработку";
