version: '3.1'

services:

  php-fpm:
    build: php
    container_name: 'php'
    ports:
      - 9000:9000
    volumes:
      - ./api:/api
    working_dir: /api
    networks:
      - travellist

  nginx:
    image: nginx
    container_name: 'nginx'
    working_dir: /api
    ports:
      - 7777:7777
    volumes:
      - ./api:/api
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
    networks:
      - travellist

  rabbitmq:
    image: rabbitmq:3.7.5-management
    working_dir: /api
    hostname: rabbit-mq
    container_name: 'rabbit-mq'
    ports:
      - 15672:15672
      - 5672:5672
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
    networks:
      - travellist

  mysql:
    build: mysql
    container_name: 'db'
    restart: unless-stopped
    ports:
      - 3307:3306
    environment:
      MYSQL_DATABASE: ${DB_DATABASE}
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_PASSWORD: ${DB_PASSWORD}
      MYSQL_USER: ${DB_USERNAME}
      SERVICE_TAGS: dev
      SERVICE_NAME: mysql
    networks:
      - travellist

  composer:
    image: composer:2
    restart: unless-stopped
    volumes:
      - ./composer/shell.sh:/home/source/shell.sh
      - ./api:/var/www/api
    entrypoint:
      - bash
      - /home/source/shell.sh

networks:
  travellist:
    driver: bridge

