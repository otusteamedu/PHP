version: '3.1'

services:

  php-fpm:
    build: php
    container_name: 'php'
    ports:
      - 9000:9000
    volumes:
      - ./code:/code
    working_dir: /code

  nginx:
    image: nginx
    container_name: 'nginx'
    working_dir: /code
    ports:
      - 7777:7777
    volumes:
      - ./code:/code
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf

  rabbitmq:
    image: rabbitmq:3.7.5-management
    working_dir: /code
    hostname: rabbit-mq
    container_name: 'rabbit-mq'
    ports:
      - 15672:15672
      - 5672:5672
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
      
  composer:
        image: composer:2
        restart: unless-stopped
        volumes:
            - ./composer/shell.sh:/home/source/shell.sh
            - ./code:/var/www/code
        entrypoint:
            - bash
            - /home/source/shell.sh
